<main>
    <h2>编辑资料</h2>
    <form id="edit-profile-form">
        <label for="username">昵称:</label>
        <input type="text" id="username" name="username" required>

        <label for="email">邮箱:</label>
        <input type="email" id="email" name="email" required>

        <label for="major">专业:</label>
        <input type="text" id="major" name="major">

        <label for="bio">个人简介:</label>
        <textarea id="bio" name="bio"></textarea>

        <label for="avatar">头像URL:</label>
        <input type="text" id="avatar" name="avatar">

        <button type="submit">保存</button>
    </form>
</main>

<script>
    // 获取用户现有资料并填入表单
    fetch('http://localhost:5000/api/profile', {
        method: 'GET',
        headers: {
            'Authorization': `Bearer ${localStorage.getItem('token')}` // 使用JWT token
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('获取用户资料失败');
        }
        return response.json();
    })
    .then(data => {
        document.getElementById('username').value = data.username;
        document.getElementById('email').value = data.email;
        document.getElementById('major').value = data.major || '';
        document.getElementById('bio').value = data.bio || '';
        document.getElementById('avatar').value = data.avatar || '';
    })
    .catch(err => {
        console.error('获取用户资料失败:', err);
    });

    // 提交编辑资料表单
    document.getElementById('edit-profile-form').addEventListener('submit', function(event) {
        event.preventDefault();

        const username = document.getElementById('username').value;
        const email = document.getElementById('email').value;
        const major = document.getElementById('major').value;
        const bio = document.getElementById('bio').value;
        const avatar = document.getElementById('avatar').value;

        fetch('http://localhost:5000/api/update-profile', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('token')}`
            },
            body: JSON.stringify({ username, email, major, bio, avatar })
        })
        .then(response => {
            if (response.ok) {
                alert('资料更新成功');
                window.location.href = 'mine.html';
            } else {
                alert('更新资料失败');
            }
        })
        .catch(err => {
            console.error('更新资料出错:', err);
            alert('更新资料出错');
        });
    });
</script>
